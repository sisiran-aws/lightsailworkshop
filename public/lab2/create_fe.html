<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.47.1" />
    <meta name="description" content="Amazon Lightsail Workshop">
<meta name="author" content="Mike Coleman">

    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
<link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
    <title>2.2 - Create the front-end instance :: Scaling and Deploying Applications with Amazon Lightsail</title>

    
    <link href="/css/nucleus.css?1535682006" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1535682006" rel="stylesheet">
    <link href="/css/hybrid.css?1535682006" rel="stylesheet">
    <link href="/css/featherlight.min.css?1535682006" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1535682006" rel="stylesheet">
    <link href="/css/auto-complete.css?1535682006" rel="stylesheet">
    <link href="/css/theme.css?1535682006" rel="stylesheet">
    <link href="/css/hugo-theme.css?1535682006" rel="stylesheet">
    
      <link href="/css/theme-mine.css?1535682006" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1535682006"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/lab2/create_fe.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1535682006"></script>
<script type="text/javascript" src="/js/auto-complete.js?1535682006"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1535682006"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction.html" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/introduction.html">
          Introduction
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/prerequisites.html" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/prerequisites.html">
          Prerequisites
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lab1.html" title="Lab #1" class="dd-item 
        
        
        
        ">
      <a href="/lab1.html">
          Lab #1
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/lab1/build_instance.html" title="1.1 - Build the MEAN instance" class="dd-item ">
        <a href="/lab1/build_instance.html">
        1.1 - Build the MEAN instance
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/lab1/configure_mongo.html" title="1.2 - Configure MongoDB" class="dd-item ">
        <a href="/lab1/configure_mongo.html">
        1.2 - Configure MongoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/lab1/deploy_app.html" title="1.3 - Start and test the app" class="dd-item ">
        <a href="/lab1/deploy_app.html">
        1.3 - Start and test the app
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lab2.html" title="Lab #2" class="dd-item 
        parent
        
        
        ">
      <a href="/lab2.html">
          Lab #2
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/lab2/create_mongo.html" title="2.1 - Deploy MongoDB" class="dd-item ">
        <a href="/lab2/create_mongo.html">
        2.1 - Deploy MongoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/lab2/create_fe.html" title="2.2 - Create the front-end instance" class="dd-item active">
        <a href="/lab2/create_fe.html">
        2.2 - Create the front-end instance
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/lab2/snapshots.html" title="2.3 - Scale the front-end" class="dd-item ">
        <a href="/lab2/snapshots.html">
        2.3 - Scale the front-end
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/lab2/load_balancer.html" title="2.4 - Load balance the front-end" class="dd-item ">
        <a href="/lab2/load_balancer.html">
        2.4 - Load balance the front-end
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/conclusion.html" title="Conclusion" class="dd-item 
        
        
        
        ">
      <a href="/conclusion.html">
          Conclusion
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cleanup.html" title="Cleanup" class="dd-item 
        
        
        
        ">
      <a href="/cleanup.html">
          Cleanup
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      
<p>
    Questions?<br>
    <a href="http://twitter.com/mikegcoleman/" target="_blank"><i class='fab fa-twitter fa-lg'></i> @mikegcoleman</a>
</p>

<p>
<br>
</p>

<p>
    Get more information on the <a href="https://aws.amazon.com/lightsail">Lightsail home page</a>
</p>

<left>
    <h5 class="copyright">&copy; 2018 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>
</left>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Amazon Lightsail Workshop</a> > <a href='/lab2.html'>Lab #2</a> > 2.2 - Create the front-end instance
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>2.2 - Create the front-end instance</h1>
          

        


<p>Next you are going to create the web front end instance. To build the front end instance you will start with the Lightsail Node.js blueprint and add in the application code from GitHub. Additionally the isntance will use a process manager, PM2, to ensure that our application starts up automatically.</p>

<p>Check out the <a href="http://pm2.keymetrics.io/">website</a> to learn more about PM2.</p>

<ul>
<li><p>From the <a href="https://lightsail.aws.amazon.com/ls/webapp/home/" target="_blank">Lightsail console home page</a> click <strong><em>Create Instance</em></strong></p>

<p><img src="../../images/2-2-1.jpg?classes=border" alt="" /></p></li>

<li><p>Make sure <strong><em>Linux/Unix</em></strong> is selected under <strong><em>Select a platform</em></strong> and then under <strong><em>Select a blueprint</em></strong> choose <strong><em>Node.js</em></strong></p>

<p><img src="../../images/2-2-2.jpg?classes=border" alt="" /></p></li>

<li><p>Click <strong><em>+Add launch script</em></strong></p>

<p><img src="../../images/2-2-3.jpg?classes=border" alt="" /></p></li>

<li><p>Paste in the script below</p>

<pre><code>#!/bin/bash

sudo /opt/bitnami/ctlscript.sh stop apache
sudo mv /opt/bitnami/apache2/scripts/ctl.sh /opt/bitnami/apache2/scripts/ctl.sh.disabled

cd /home/bitnami

sudo git clone https://github.com/mikegcoleman/todo

cd /home/bitnami/todo

sudo npm install --production
sudo npm install pm2@latest -g
</code></pre>

<p>This script does the following:</p>

<ul>
<li>Disables Apache to free up port 80 for the web front end</li>
<li>Clones in the application code from the GitHub repo</li>
<li>Uses <strong><em>npm</em></strong> to install the application dependencies and PM2
<br /></li>
</ul></li>

<li><p>Name the instance <strong><em>node-fe-1</em></strong></p>

<p><img src="../../images/2-2-5.jpg?classes=border" alt="" /></p></li>

<li><p>Click <strong><em>Create</em></strong></p>

<p><img src="../../images/2-2-6.jpg?classes=border" alt="" /></p></li>

<li><p>Wait for the instance to reach a running state, and then SSH into the instance (username: <strong><em>bitnami</em></strong>)</p></li>
</ul>

<div class="notices tip" ><p>The following commands need to be run from the command line of the Node.js instance*</p>
</div>


<ul>
<li><p>Set an environment variable to hold the MongoDB private IP address by executing the command below and substituting the IP address your recorded above.</p>

<pre><code>IP=&lt;MongoDB instance private IP&gt;
</code></pre>

<p>For example:</p>

<pre><code>IP=172.12.14.1
</code></pre></li>

<li><p>Ensure the IP is correctly set by typing the command below. The output should be the private IP of the MongoDB instance</p>

<pre><code>echo $IP
</code></pre></li>

<li><p>Change into the application directory</p>

<pre><code>cd ~/todo
</code></pre></li>

<li><p>Create a config file to hold our environment variables by pasting the following lines at the command prompt in the NodeJS instance.</p>

<pre><code>sudo sh -c &quot;cat &gt; ./.env&quot;  &lt;&lt; EOF
PORT=80
DB_URL=mongodb://$IP:27017/
EOF
</code></pre>

<p>These variables specify the port the application will run on, and the connection string for the MongoDB host</p></li>

<li><p>Ensure the file was created succesfully by using <strong><em>cat</em></strong> to list out the contents</p>

<pre><code>cat ./.env
</code></pre>

<p>The output should be similar to below (ensure the IP address matches the <strong>PRIVATE IP</strong> of your Mongo instance)</p>

<pre><code>PORT=80
DB_URL=mongodb://IP=172.12.14.1:27017/
</code></pre></li>

<li><p>Configure PM2 for use with Ubuntu by issuing the following command</p>

<pre><code>sudo pm2 startup ubuntu
</code></pre></li>

<li><p>Start the application using PM2</p>

<pre><code>sudo pm2 start /home/bitnami/todo/bin/www
</code></pre></li>

<li><p>Save out the current process list for PM2. This will allow PM2 to start the application when the instance boots up subsequently</p>

<pre><code>sudo pm2 save
</code></pre></li>

<li><p>Issue the following command to have PM2 stream the application logs to the console</p>

<pre><code>sudo pm2 logs www
</code></pre></li>

<li><p>Ensure everything is working by navigating the the <strong>PUBLIC IP</strong> of your <strong><em>node-fe-1</em></strong> Instance</p>

<p>You should see the todo application in your web browser and if you check the SSH session there should be some output there as well similar to the below:</p>

<pre><code>0|www  | GET / 200 1005 - 42.341 ms
0|www  | GET /stylesheets/style.css 200 89 - 2.430 ms
0|www  | GET /css/bootstrap.min.css 200 140936 - 3.865 ms
0|www  | GET /css/fontawesome-all.css 200 51609 - 0.807 ms
0|www  | GET /js/bootstrap.min.js 200 51039 - 4.965 ms
0|www  | GET /js/jquery.min.js 200 86927 - 2.875 ms
</code></pre></li>
</ul>

<div class="notices tip" ><p>You can find the public IP on the card with the instance name for the <strong><em>node-fe-1</em></strong> instance on the Lightsail home page</p>
</div>


<p><img src="../../images/2-2-13.jpg?classes=border" alt="" /></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/lab2/create_mongo.html" title="2.1 - Deploy MongoDB"> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/lab2/snapshots.html" title="2.3 - Scale the front-end" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1535682006"></script>
    <script src="/js/perfect-scrollbar.min.js?1535682006"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1535682006"></script>
    <script src="/js/jquery.sticky.js?1535682006"></script>
    <script src="/js/featherlight.min.js?1535682006"></script>
    <script src="/js/html5shiv-printshiv.min.js?1535682006"></script>
    <script src="/js/highlight.pack.js?1535682006"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1535682006"></script>
    <script src="/js/learn.js?1535682006"></script>
    <script src="/js/hugo-learn.js?1535682006"></script>

    <link href="/mermaid/mermaid.css?1535682006" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1535682006"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

